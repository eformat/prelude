FROM registry.redhat.io/ubi10/go-toolset:10.1 AS builder

WORKDIR /opt/app-root/src

COPY server/go.mod server/go.sum ./
RUN go mod download

COPY server/main.go ./
RUN CGO_ENABLED=0 go build -o /opt/app-root/server .

FROM registry.redhat.io/ubi10/ubi-minimal:latest

COPY --from=builder /opt/app-root/server /usr/local/bin/server

EXPOSE 8080

ENTRYPOINT ["server"]
